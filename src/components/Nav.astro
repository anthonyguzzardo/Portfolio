---
const pathname = Astro.url.pathname;
const isHome = pathname === '/';
---
<nav class={`nav ${isHome ? 'nav-transparent' : ''}`}>
  <div class="container nav-container">
    <a href="/" class="nav-logo">
      <span class="nav-name">Anthony Guzzardo</span>
      <span class="nav-location">Chicago</span>
    </a>

    <div class="nav-center">
      <a href="/projects" class={pathname.startsWith('/projects') ? 'active' : ''}>Projects</a>
      <a href="/contact" class={pathname.startsWith('/contact') ? 'active' : ''}>Contact</a>
    </div>

    <div class="nav-right">
      <button id="copy-email" class="copy-email-btn" aria-label="Copy email">
        <svg class="email-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="2" y="4" width="20" height="16" rx="2"/>
          <path d="M22 6l-10 7L2 6"/>
        </svg>
        <span class="copy-email-text">Email</span>
      </button>
      <a href="https://github.com/anthonyguzzardo" target="_blank">GitHub</a>
      <a href="https://www.linkedin.com/in/anthony-guzzardo" target="_blank">LinkedIn</a>
      <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme">
        <svg class="sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="5"/>
          <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
        </svg>
        <svg class="moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
        </svg>
      </button>
    </div>
  </div>
</nav>

<script>
  const toggle = document.getElementById('theme-toggle');
  const html = document.documentElement;

  // Check for saved preference or default to dark
  const savedTheme = localStorage.getItem('theme') || 'dark';
  html.setAttribute('data-theme', savedTheme);

  toggle?.addEventListener('click', () => {
    const current = html.getAttribute('data-theme');
    const next = current === 'dark' ? 'light' : 'dark';
    html.setAttribute('data-theme', next);
    localStorage.setItem('theme', next);
  });

  // Copy email button
  const copyBtn = document.getElementById('copy-email');
  const emailText = copyBtn?.querySelector('.copy-email-text');

  copyBtn?.addEventListener('click', async () => {
    try {
      await navigator.clipboard.writeText('agguzzy91@gmail.com');
      if (emailText) {
        emailText.textContent = 'Copied!';
        setTimeout(() => {
          emailText.textContent = 'Email';
        }, 2000);
      }
    } catch (err) {
      // Fallback - open mailto
      window.location.href = 'mailto:agguzzy91@gmail.com';
    }
  });
</script>
